I"2<p>iOS 앱의 상태 변화에 따른 동작을 처리하는 App Delegate 메서드들이 있다.
이 메서드들과 함께 앱이 어떠한 실행과정을 거쳐서 AppDelegate를 생성하는지까지 알아보려한다.
내가 원하는 동작을 효과적으로 구현하기 위해서는 iOS와 UIKit 프레임워크가 어떻게 동작하는지 이해하는게 중요하다.</p>

<h2 id="-ios-app의-실행과정">🧩 iOS App의 실행과정</h2>
<p>먼저 앱의 실행과정을 알아본다. 실행과정은 아래와 같다.</p>

<blockquote>
  <ol>
    <li>main 함수 실행</li>
    <li>UIKit 프레임워크의 <a href="https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain">UIApplicationMain(_ : _ : _ : _ :)</a> 함수 실행
      <ul>
        <li>1) <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 싱글턴 객체 생성</li>
        <li>2) <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate">AppDelegate</a> 객체 생성 및 <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 객체와 연결(delegate 설정)</li>
        <li>3) <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 객체가 info.plist 파일에서 앱 실행에 필요한 데이터와 객체 로드</li>
        <li>4) <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 객체가 Main Event Loop를 생성하고 관리</li>
        <li>5) (Info.plist에 main storyboard 세팅된 경우) <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 객체가 main NIB 파일에서 main UI 로드</li>
      </ul>
    </li>
    <li>AppDelegate의 <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623032-application">application(_:willFinishLaunchingWithOptions:)</a> 호출</li>
    <li>AppDelegate 및 ViewControllers의 추가 메서드를 호출하여 앱 상태 복원</li>
    <li>AppDelegate의 <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application">application(_:didFinishLaunchingWithOptions:)</a> 호출</li>
    <li>(Info.plist에 main storyboard 세팅되지 않은 경우) main UI 로드</li>
    <li>앱 이벤트 루프에서 이벤트 핸들링 시작</li>
    <li>앱 사용!</li>
  </ol>
</blockquote>

<p><br /></p>
<p align="center">
   <img src="../images/2021-05-17-til-20210517/1.png" width="700" />
   <em style="font-size: 0.9em;">출처: https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/</em>
</p>
<p><br /></p>

<p align="center">
   <img src="../images/2021-05-17-til-20210517/2.png" width="600" />
   <em style="font-size: 0.9em;">출처: https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app</em>
</p>
<p><br /></p>

<h3 id="1-main-함수와-uiapplicationmain">1. main 함수와 UIApplicationMain</h3>
<p>swift에서는 main.m이 자동으로 생성되는 Objective-C와 다르게,
Appdelegate.swift의 @UIApplicationMain 어노테이션을 없애고 main.swift를 직접 생성하여 main 함수를 커스텀할 수 있다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kt">UIApplicationMain</span><span class="p">(</span><span class="kt">CommandLine</span><span class="o">.</span><span class="n">argc</span><span class="p">,</span>
                  <span class="kt">UnsafeMutableRawPointer</span><span class="p">(</span><span class="kt">CommandLine</span><span class="o">.</span><span class="n">unsafeArgv</span><span class="p">)</span><span class="o">.</span><span class="nf">bindMemory</span><span class="p">(</span>
                      <span class="nv">to</span><span class="p">:</span> <span class="kt">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="kt">Int8</span><span class="o">&gt;.</span><span class="k">self</span><span class="p">,</span>
                      <span class="nv">capacity</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="kt">CommandLine</span><span class="o">.</span><span class="n">argc</span><span class="p">)),</span>
                  <span class="kc">nil</span><span class="p">,</span>
                  <span class="kt">NSStringFromClass</span><span class="p">(</span><span class="kt">AppDelegate</span><span class="o">.</span><span class="k">self</span><span class="p">))</span>
</code></pre></div></div>

<p>main 함수에서 실행되는 <a href="https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain">UIApplicationMain(_ : _ : _ : _ :)</a> 함수는 UIApplication 객체와 AppDelegate 객체를 생성하여 연결(delegate)하고 Main Event Loop를 세팅한다. Main Event Loop는 앱의 Run Loop를 포함하며 처리 이벤트를 시작한다.</p>

<p>공식문서에서 <a href="https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain">UIApplicationMain(_ : _ : _ : _ :)</a> 함수의 선언부분을 보면 아래와 같다.</p>

<p align="center">
   <img src="../images/2021-05-17-til-20210517/3.png" width="700" />
</p>

<p>3,4번째 파라미터인 principalClassName와 delegateClassName 는 각각 <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 클래스 이름과 <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate">AppDelegate</a>로 초기화될 클래스 이름이다.</p>

<p><br /></p>

<h3 id="2-uiapplication">2. UIApplication</h3>
<p><a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a>은 iOS에서 실행되는 앱을 위한 중앙화된 제어 및 조정 지점… 이라고 한다. 공식문서에서 <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a>의 선언부분을 보면 아래와 같다.</p>

<p align="center">
   <img src="../images/2021-05-17-til-20210517/4.png" width="700" />
</p>

<p><a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a>는 <a href="https://developer.apple.com/documentation/uikit/uiresponder">UIResponder</a> 클래스를 상속받는데, <a href="https://developer.apple.com/documentation/uikit/uiresponder">UIResponder</a> 클래스는 이벤트에 반응하여 처리해주기 위한 목적의 추상 인터페이스이다.
<a href="https://developer.apple.com/documentation/uikit/uiresponder">UIResponder</a> 인스턴스는 UIKit 앱의 이벤트를 처리하는 <strong>백본</strong>을 구성하고 UIKit은 이벤트가 발생할 때마다 해당 이벤트를 처리해주는 UIResponder 객체로 dispatch 해주게 된다. UIResponder는 <a href="https://developer.apple.com/documentation/uikit/uiapplication">UIApplication</a> 뿐만 아니라 <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller">UIViewController</a>, <a href="https://developer.apple.com/documentation/uikit/uiview">UIView</a>도 될 수 있다.</p>

<p>UIApplication의 역할을 살펴보면 아래와 같다.</p>

<ol>
  <li>유저 이벤트의 초기 라우팅 처리. UIControl 클래스의 인스턴스에 의해 전달된 이벤트 메시지를 적절한 대상 객체에 전달해줌.</li>
  <li>앱의 UIView 객체들을 확인할 수 있는 UIWindow 객체 목록을 갖고있음.</li>
  <li>UIApplicationDelegate 프로토콜을 준수하는 Delegate(=<a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate">AppDelegate</a>)를 정의함. UIApplication은 이 Delegate에 앱 시작, 메모리 부족 경고,
앱 종료와 같은 상당히 중요한 런타임 이벤트를 알려줌으로써 적절하게 대응할 수 있도록 해줌.</li>
  <li>이메일 또는 이미지파일과 같은 리소스를 <a href="https://developer.apple.com/documentation/uikit/uiapplication/1648685-open">open(_:options:completionHandler:)</a> 메서드로 처리할 수 있음. 예를 들어, email URL로 이 메서드를 호출하는 앱은 Mail 앱을 시작하고 메시지를 보여줄 수 있음.</li>
  <li><a href="https://developer.apple.com/documentation/uikit/uiapplication/1648685-open">open(_:options:completionHandler:)</a> 뿐만이 아니라 UIApplication의 다른 API를 사용하면 디바이스별 동작을 관리할 수 있음.
    <ul>
      <li>원격 알림 등록 (<a href="https://developer.apple.com/documentation/uikit/uiapplication/1623078-registerforremotenotifications">registerForRemoteNotifications()</a>)</li>
      <li>실행취소-재실행 UI 트리거 (<a href="https://developer.apple.com/documentation/uikit/uiapplication/1623127-applicationsupportsshaketoedit">applicationSupportsShakeToEdit</a>)</li>
      <li>URL 스킴을 처리하기 위해 등록된 앱이 설치되어있는지 결정 (<a href="https://developer.apple.com/documentation/uikit/uiapplication/1622952-canopenurl">canOpenURL(_:)</a>)</li>
      <li>백그라운드 작업을 완료할 수 있도록하기 위한 앱 실행 확장 ([beginBackgroundTask(expirationHandler:)] and [beginBackgroundTask(withName:expirationHandler:)])</li>
      <li>로컬 알림 스케쥴링 및 취소 ([scheduleLocalNotification(<em>:)] and [cancelLocalNotification(</em>:)])</li>
      <li>원격-제어 이벤트 수신 조정 ([beginReceivingRemoteControlEvents()] and [endReceivingRemoteControlEvents()])</li>
      <li>앱 상태 복원 작업 수행 (상태 복원 작업을 관리하는 그룹의 메서드)</li>
    </ul>
  </li>
</ol>

<p>이니셜 라우팅, 들어오는 유저 이벤트 처리. 액션 메시지를 UIControl 인스턴스로부터 적절한 타겟 객체로 보낸다. 얘는 오픈된 UIWindow 리스트를 유지하고 이로부터 UIView 오브젝트를 가져올 수 있다.</p>

<p>UIApplication은 UIApplication Delegate 프로토콜을 따르는 delegate를 정의하고 반드시 몇ㅊ개의 프로토콜 메서드를 추가해야 한다. UIApplication은 중요한 런타임 이벤트를 delegate에 알리는데 이는 앱 런치, 저메모리 워닝, 앱 제거 등이 있고 적절하게 대응할 수 있는 기회를 준다.</p>

<p>앱은 메일이나 이미지 파일등의 리소스를 처리할 수 있는다. open 메서드로. 예를 들어 앱에서 email URL을 호출하면 MAil 앱이 런치되고 메시지가 보여진다. 이 클래스의 API는 너가 디바이스 명시적 행동을 관리하도록 허락한다. UIApplication 오브젝트는 아래의 것ㄷ르을 할 수 있다.</p>

<ul>
  <li>블라블라 블라</li>
</ul>

<p>대부분의 앱은 UIApplication 을 서브클래싱 할 필요가 없으나, 시스템과 앱 사이의 상호작용을 관리하기 위해 app delegate를 사용한다. 니 앱이 반드시 들어오는 이벤트를 시스템 전ㄴ에 처리해야한다면, UIApplcation을 서브클래싱하고 sendEvent나 sendAction을 오버라이딩해서 니 할일 선처리하고 super. 메서드로 시스템한테 다시 dispath 하면 된다. 되도록이면 안하는게 좋다.</p>

<h2 id="appdelegate">AppDelegate</h2>
<p>AppDelegate를 알아보기로 해놓고 너무 많은 걸 더 알아봤다. 이제 APpDelegate가 무엇인지 파악해보자</p>

<h2 id="appdelegate의-메서드">AppDelegate의 메서드</h2>
<p>각 메소드가 call 되는 시점 및 어떤 행동을 하는지</p>

<p>https://programmersought.com/article/7299631766/
https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623032-application
(저장되어있는 데이터나 상태를 바탕으로 UI를 세팅. 이 단계는 inactive 상태. willFinishLaunchingWithOptions method is called after your app has been launched and its main storyboard or nib file has been loaded, but before your app’s state has been restored )</p>

<h2 id="결론">결론</h2>

<h2 id="레퍼런스">레퍼런스</h2>
<ul>
  <li><a href="https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/">https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/</a></li>
  <li><a href="https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app">https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app</a></li>
  <li><a href="https://developer.apple.com/documentation/uikit/app_and_environment/responding_to_the_launch_of_your_app/about_the_app_launch_sequence">https://developer.apple.com/documentation/uikit/app-and-environment/responding-to-the-launch-of-your-app/about-the-app-launch_sequence</a></li>
  <li><a href="https://medium.com/@anandin02/ios-application-launch-sequence-a13a267d1669">https://medium.com/@anandin02/ios-application-launch-sequence-a13a267d1669</a></li>
  <li><a href="https://zeddios.tistory.com/1049">https://zeddios.tistory.com/1049</a></li>
</ul>
:ET