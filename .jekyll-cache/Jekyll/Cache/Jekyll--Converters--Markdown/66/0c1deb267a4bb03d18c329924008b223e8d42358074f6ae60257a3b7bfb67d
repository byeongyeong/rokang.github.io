I"´3<p>ì•± ê°œë°œì„ í•  ë•Œ JSON ë°ì´í„° ì²˜ë¦¬ëŠ” ê¸°ë³¸ì´ë©´ì„œë„ ì •ë§ ì¤‘ìš”í•©ë‹ˆë‹¤. ê¸°ì¡´ì—ëŠ” JSONì„ ì£¼ë¨¹êµ¬êµ¬ì‹ìœ¼ë¡œ í•¸ë“¤ë§í•˜ê±°ë‚˜ <code class="highlighter-rouge">SwiftyJSON</code>ì„ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, <code class="highlighter-rouge">Swift4</code>ì—ì„œ ìƒˆë¡œ ë„ì…ëœ <code class="highlighter-rouge">Codable</code>ì„ ì•Œê²Œë˜ì„œ ì´ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ JSON ë°ì´í„°ë¥¼ ë” ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•˜ê³ ì í•©ë‹ˆë‹¤.</p>

<h1 id="json-ì˜ˆì‹œ">JSON ì˜ˆì‹œ</h1>
<!-- JSON ì˜ˆì œ ì½”ë“œ -->
<noscript><pre>{
  &quot;data&quot;: {
    &quot;room&quot;: [
      {
        &quot;name&quot;: &quot;room1&quot;,
        &quot;order&quot;: 1,
        &quot;messages&quot;: [
          {
            &quot;content&quot;: &quot;Mom&quot;,
            &quot;person&quot;: &quot;Tom&quot;,
            &quot;order&quot;: 1
          },
          {
            &quot;content&quot;: &quot;I&#39;m sorry&quot;,
            &quot;person&quot;: &quot;Will&quot;,
            &quot;order&quot;: 2
          },
          {
            &quot;content&quot;: &quot;Thank you&quot;,
            &quot;person&quot;: &quot;Big brother Tom&quot;,
            &quot;order&quot;: 3
          }
        ]
      }
    ]
  }
}</pre></noscript>
<script src="https://gist.github.com/RoKang/cf87c669c296a5392395a7e1eb0f9561.js"> </script>

<h1 id="before">Before</h1>
<p>ìœ„ì˜ ì˜ˆì‹œë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì¡´ì— ì‘ì„±í–ˆë˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
<!-- í•˜ë“œí•˜ê²Œ ë””ì½”ë”©í•œ ì½”ë“œ --></p>
<noscript><pre>if let data = jsonString.data(using: .utf8) {
    if let decoded = try? JSONSerialization.jsonObject(with: data, options: []) {
        let dataDic = (decoded as? [String: Any])?[&quot;data&quot;] as? [String: Any] ?? [:]
        let roomArray = dataDic[&quot;room&quot;] as? [[String: Any]] ?? []

        for room in roomArray {
            print(room[&quot;name&quot;])
            print(room[&quot;order&quot;])
            
            let messages = room[&quot;messages&quot;] as? [[String: Any]] ?? []
            
            for msg in messages {
                print(msg[&quot;content&quot;])
                print(msg[&quot;person&quot;])
                print(msg[&quot;order&quot;])
            }
        }
    }
}</pre></noscript>
<script src="https://gist.github.com/RoKang/550a3febcce5421f7020a9ef5185c389.js"> </script>

<h1 id="codable">Codable</h1>
<p><code class="highlighter-rouge">Codable</code>ì„ ì ìš©í•˜ê¸° ì „ì— ì´ í”„ë¡œí† ì½œì´ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì•Œì•„ì•¼ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. Codableì€ Decodableê³¼ Encodableì„ í¬í•¨í•˜ëŠ” í”„ë¡œí† ì½œì´ë¼ê³  <a href="https://developer.apple.com/documentation/swift/codable" target="blank">ì• í”Œ ê³µì‹ ë¬¸ì„œ</a>ì— ë‚˜ì™€ìˆë„¤ìš”. <a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types" target="blank">Encoding and Decoding Custom Types</a>ì—ì„œ, SwiftëŠ” ë°ì´í„°ë¥¼ ì¸ì½”ë”©í•˜ê³  ë””ì½”ë”©í•˜ëŠ” í‘œì¤€í™” ëœ ì ‘ê·¼ë²•ì„ ì •ì˜í•˜ê³  ìˆìœ¼ë©°, ì´ ì ‘ê·¼ë²•ì€ Decodableê³¼ Encodable í”„ë¡œí† ì½œì„ ì ìš©í•œ ë°©ë²•ì´ë¼ê³  í•©ë‹ˆë‹¤. ê·¸ëŸ¼ ì´ì œ Codableë¡œ ì½”ë“œë¥¼ ë°”ê¿”ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<h1 id="struct-with-codable">Struct with Codable</h1>
<p>ì˜ˆì‹œë¡œ ë“  JSONì—ëŠ” room key ì•ˆì— ë°°ì—´ ë°ì´í„°ê°€ ìˆê³ , messages keyì•ˆì— ë°°ì—´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ <strong>Result &gt; Room &gt; Message</strong> ì§‘í•© ê´€ê³„ë¡œ ì •ì˜ëœ êµ¬ì¡°ì²´ì— Codableì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
<!-- Codable ì ìš©í•œ êµ¬ì¡°ì²´ ì½”ë“œ --></p>
<noscript><pre>struct Result: Decodable {
    var success: Bool?
    var reason: String?
    var rooms: [Room]?
    
    enum CodingKeys: String, CodingKey {
        case success, reason, rooms = &quot;room&quot;
        case data = &quot;data&quot;
    }
    
    init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        let data = try container.nestedContainer(keyedBy: CodingKeys.self, forKey: .data)
        
        success = try container.decode(Bool.self, forKey: .success)
        reason = try container.decode(String.self, forKey: .reason)
        rooms = try data.decode([Room].self, forKey: .rooms)
    }
}

struct Room: Codable {
    var name: String?
    var order: Int?
    var messages: [Message]?
    
    enum CodingKeys: String, CodingKey {
        case name, order, messages
    }
    
    init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        name = try container.decode(String.self, forKey: .name)
        order = try container.decode(Int.self, forKey: .order)
        messages = try container.decode([Message].self, forKey: .messages)
    }
}

struct Message : Codable {
    var content: String?
    var person: String?
    var order: Int?
    
    enum CodingKeys: String, CodingKey {
        case content, person, order
    }
    
    init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        content = try container.decode(String.self, forKey: .content)
        person = try container.decode(String.self, forKey: .person)
        order = try container.decode(Int.self, forKey: .order)
    }
}</pre></noscript>
<script src="https://gist.github.com/RoKang/e665070d5d6d6b873446e217e2ea8072.js"> </script>

<h1 id="after">After</h1>
<!-- Codableì´ ì ìš©ëœ êµ¬ì¡°ì²´ë¡œ ë””ì½”ë”©í•˜ëŠ” ì˜ˆì œ ì½”ë“œ -->
<noscript><pre>let data = jsonString.data(using: .utf8) ?? Data()
if let result = try? JSONDecoder().decode(Result.self, from: data) {
    print(&quot;success : \(result.success ?? false)&quot;)
    print(&quot;reason : \(result.reason ?? &quot;&quot;)\n&quot;)
    
    result.rooms?.forEach{ room in
        print(&quot;  name : \(room.name ?? &quot;&quot;)&quot;)
        print(&quot;  order : \(room.order ?? 0)\n&quot;)
        
        room.messages?.forEach { message in
            print(&quot;    content : \(message.content ?? &quot;&quot;)&quot;)
            print(&quot;    person : \(message.person ?? &quot;&quot;)&quot;)
            print(&quot;    order : \(message.order ?? 0)\n&quot;)
        }
    }
}</pre></noscript>
<script src="https://gist.github.com/RoKang/5a0e1026e5313142c2db2a216bea93d3.js"> </script>

<p><code class="highlighter-rouge">try? JSONDecoder().decode(Result.self, from: data)</code> ì½”ë“œ í•œ ì¤„ë¡œ Result, Room, Message ë°ì´í„°ê¹Œì§€ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë©´ CodingKeyë¼ëŠ” ë‚¯ì„  ì¹œêµ¬ê°€ ë³´ì…ë‹ˆë‹¤. ì´ ì¹œêµ¬ì™€ í•¨ê»˜ <code class="highlighter-rouge">init(from decoder: Decoder)</code>ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h1 id="codingkey">CodingKey</h1>
<p><a href="https://developer.apple.com/documentation/swift/codingkey" target="blank">CodingKey</a>ëŠ” ì¸ì½”ë”©ê³¼ ë””ì½”ë”©ì„ ìœ„í•œ í‚¤ë¡œ ì“°ì´ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. ì½”ë“œë¥¼ ë‹¤ì‹œ ë³´ì‹œë©´ CodingKey í”„ë¡œí† ì½œì„ ì±„íƒí•œ CodingKeysì˜ caseê°€ json ë°ì´í„°ì˜ keyë¡œ ë§¤í•‘ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Resultì˜ â€œroomsâ€ì—ëŠ” â€œroomâ€ keyì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ë§¤í•‘ë©ë‹ˆë‹¤. ê·¸ëŸ¼ ì½”ë“œê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì¢€ ë” ìì„¸í•˜ê²Œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ol>
  <li>decode ë©”ì„œë“œëŠ” ë””ì½”ë”© ë  dataë¡œë¶€í„° Result íƒ€ì…ì˜ valueë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
<!-- í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ 1 --></li>
</ol>
<noscript><pre>if let result = try? JSONDecoder().decode(Result.self, from: data)

/// decode í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬

/// Decodes a top-level value of the given type from the given JSON representation.
///
/// - parameter type: The type of the value to decode.
/// - parameter data: The data to decode from.
/// - returns: A value of the requested type.
/// - throws: `DecodingError.dataCorrupted` if values requested from the payload are corrupted, or if the given data is not valid JSON.
/// - throws: An error if any value throws an error during decoding.
open func decode&lt;T&gt;(_ type: T.Type, from data: Data) throws -&gt; T where T : Decodable</pre></noscript>
<script src="https://gist.github.com/RoKang/3f1252e502a98ce31801600d325a9d32.js"> </script>

<ol>
  <li>1ë²ˆ ì½”ë“œê°€ Resultë¥¼ ì´ˆê¸°í™”í•˜ëŠ” init ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê² ë„¤ìš”. decoderì— ë‹´ê²¨ìˆë˜ dataë¡œë¶€í„° containerë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. <code class="highlighter-rouge">CodingKeys.self</code> íƒ€ì…ì´ dataì˜ keyì™€ ë§¤í•‘ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ <code class="highlighter-rouge">DecodingError.typeMismatch</code> ì—ëŸ¬ë¥¼ ë˜ì§€ê² ë„¤ìš”.
<!-- í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ 2 --></li>
</ol>
<noscript><pre>let container = try decoder.container(keyedBy: CodingKeys.self)

/// container 

/// Returns the data stored in this decoder as represented in a container
/// keyed by the given key type.
///
/// - parameter type: The key type to use for the container.
/// - returns: A keyed decoding container view into this decoder.
/// - throws: `DecodingError.typeMismatch` if the encountered stored value is
///   not a keyed container.
func container&lt;Key&gt;(keyedBy type: Key.Type) throws -&gt; KeyedDecodingContainer&lt;Key&gt; where Key : CodingKey</pre></noscript>
<script src="https://gist.github.com/RoKang/c1e77fd8d79dc5816d67cd85b08ea030.js"> </script>

<ol>
  <li>nestedì´ê¸° ë•Œë¬¸ì— forKey íŒŒë¼ë¯¸í„°ê°€ ì¶”ê°€ë˜ì„œ í•´ë‹¹ í‚¤ì— ëŒ€í•œ sub containerë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.
<!-- í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ 3 --></li>
</ol>
<noscript><pre>let data = try container.nestedContainer(keyedBy: CodingKeys.self, forKey: .data)

///  nestedContainer í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬

/// Returns the data stored for the given key as represented in a container
/// keyed by the given key type.
///
/// - parameter type: The key type to use for the container.
/// - parameter key: The key that the nested container is associated with.
/// - returns: A keyed decoding container view into `self`.
/// - throws: `DecodingError.typeMismatch` if the encountered stored value is
///   not a keyed container.
public func nestedContainer&lt;NestedKey&gt;(keyedBy type: NestedKey.Type, forKey key: KeyedDecodingContainer&lt;K&gt;.Key) throws -&gt; KeyedDecodingContainer&lt;NestedKey&gt; where NestedKey : CodingKey</pre></noscript>
<script src="https://gist.github.com/RoKang/0c1a401def1d28b496f0bf3947560525.js"> </script>

<ol>
  <li>sub containerì¸ data ì¸ìŠ¤í„´ìŠ¤ì—ì„œ â€œroomâ€ keyì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ [Room] íƒ€ì…ì˜ valueë¡œ ë””ì½”ë”© í•´ì¤ë‹ˆë‹¤.
Room íƒ€ì…ë„ êµ¬ì¡°ì²´ì´ê¸° ë•Œë¬¸ì— ì´ ê³¼ì •ì—ì„œ Roomì˜ initë„ ì‹¤í–‰ì´ ë˜ê² ë„¤ìš”.
<!-- í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ 4 --></li>
</ol>
<noscript><pre>rooms = try data.decode([Room].self, forKey: .rooms)

/// decode í‘œì¤€ 

/// Decodes a value of the given type for the given key.
///
/// - parameter type: The type of value to decode.
/// - parameter key: The key that the decoded value is associated with.
/// - returns: A value of the requested type, if present for the given key
///   and convertible to the requested type.
/// - throws: `DecodingError.typeMismatch` if the encountered encoded value
///   is not convertible to the requested type.
/// - throws: `DecodingError.keyNotFound` if `self` does not have an entry
///   for the given key.
/// - throws: `DecodingError.valueNotFound` if `self` has a null entry for
///   the given key.
public func decode&lt;T&gt;(_ type: T.Type, forKey key: KeyedDecodingContainer&lt;K&gt;.Key) throws -&gt; T where T : Decodable</pre></noscript>
<script src="https://gist.github.com/RoKang/a56af6bb733cf19bebbbf177f460d831.js"> </script>

<p>ì§€ê¸ˆê¹Œì§€ì˜ ë‚´ìš©ì´ ë””ì½”ë”©ë§Œ ë‹¤ë£¨ê³  ìˆì§€ë§Œ, ì¸ì½”ë”©ì€ JSONEncoder í´ë˜ìŠ¤ë¥¼ í™œìš©í•œ ë°˜ëŒ€ì˜ ê³¼ì •ì´ë‹ˆê¹Œ ì‹ì€ ì£½ ë¨¹ê¸° ì•„ë‹ê¹Œ ì‹¶ë„¤ìš” í¬í¬</p>

<h1 id="tip">Tip</h1>
<ul>
  <li>
    <p>ë°”ë‹ë¼ Codableë„ JSONSerializationì„ ì‚¬ìš©í•œ ë°©ë²•ì— ë¹„í•´ì„œ í›¨ì”¬ í¸í•´ì¡Œì§€ë§Œ, <a href="https://github.com/JohnSundell/Codextended" target="blank">Codextended</a>ëŠ” Codable ì½”ë“œë¥¼ ë” ê¹”ë”í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. Codableì— ìµìˆ™í•´ì§„ë‹¤ë©´ ê³ ë ¤í•´ ë³¼ ë§Œí•œ ì˜µì…˜ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë‚ ì§œ JSON ë°ì´í„°ë¥¼ Date íƒ€ì…ìœ¼ë¡œ í¬ë§·íŒ…í•˜ëŠ”ê±´ ìƒê°ë³´ë‹¤ ê·€ì°®ì€ ì¼ ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ Codableì—ëŠ” ì–´ë–¤ ë‚ ì§œ ë°ì´í„°ê°€ <strong>íŠ¹ì • í¬ë§·ì— ë§ë‹¤ë©´ ìë™ìœ¼ë¡œ Date ì¸ìŠ¤í„´ìŠ¤ë¡œ ë””ì½”ë”© í•´ì£¼ëŠ” strategy(ì „ëµ)</strong>ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<!-- JSONDecoder().dateDecodingStrategy ì˜ˆì œ ì½”ë“œ 1 --><noscript>&lt;pre&gt;let formatter = DateFormatter()
formatter.dateFormat = "yyyy.MM.dd"
JSONDecoder().dateDecodingStrategy = .formatted(formatter)
JSONDecoder().dateDecodingStrategy = .iso8601
JSONDecoder().dateDecodingStrategy = .millisecondsSince1970
JSONDecoder().dateDecodingStrategy = .secondsSince1970&lt;/pre&gt;</noscript><script src="https://gist.github.com/RoKang/fa262e9d404d05cf4c7938978fbf7043.js"> </script> formatter ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì›í•˜ëŠ” í¬ë§·ì˜ ë°ì´í„°ë¥¼ Dateë¡œ ë³€í™˜í•  ìˆ˜ë„ ìˆê³  iso8601 ì˜µì…˜ì²˜ëŸ¼ í‘œì¤€í™” ëœ í¬ë§·ì„ ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” formattedë‚˜ iso8601 ì˜µì…˜ì„ ë§ì´ í™œìš©í•˜ê²Œ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>
  </li>
</ul>
:ET