I""<p>2020 6월 6일의 TIL.</p>

<h3 id="defer문">defer문</h3>
<p>Swift 2.0에서 추가된 구문으로 링크드리스트의 remove 파트를 공부하다가 알게 됨.<br />
컨텍스트 매니저처럼 현재 스코프를 벗어나는 시점에 동작할 것을 미리 정할 수 있게 해주는 구문.<br />
File Open이나 DB 혹은 Network 연결을 만들어 놓고 작업하는 중 예외를 만나도 안전하게 리소스를 닫을 수 있게 해주는 꿀떡 구문.<br />
defer문은 스코프 내에서 스택에 쌓이게 되어 여러 개의 defer문이 정의되어 있으면 LIFO로 실행된다고 함.</p>

<h3 id="sequence-collection-protocol">Sequence, Collection Protocol</h3>
<p>TIL로 정리하기엔 무리일만큼 중요함.<br />
<strong>Swift의 정수라고도 볼 수 있는 <code class="highlighter-rouge">Array</code>타입의 핵심 프로토콜들이기 때문이다.</strong><br />
Sequence는 for-in 구문에 사용할 수 있게 순회할 수 있는 타입을 정의할 때 사용하고,
Collection은 Sequence를 상속하면서 임의의 인덱스로 특정 위치의 값에 접근할 수 있게 해준다는 점만 일단 기억.</p>
<blockquote>
  <p>Array, Sequence, Collection에 대한 더 자세한 내용은 따로 정리를 할 예정입니다.</p>
</blockquote>

<h3 id="cowcopy-on-write">Cow(Copy-on-Write)</h3>
<p>Swift의 Array는 값 타입이기 떄문에 Array 인스턴스를 복사하게 되면 말 그대로 <code class="highlighter-rouge">새로운 공간을 추가로 할당해야 함</code>.
비효율적인 방식이지만 Value semantic을 유지함과 동시에 효율성을 높여주는 장치가 <code class="highlighter-rouge">CoW</code>.
처음 인스턴스를 복사하게 되면 레퍼런스를 할당해서 같은 인스턴스를 참조하게 되지만,<br />
<code class="highlighter-rouge">복사된 레퍼런스에 mutation이 발생하면 실제로 값을 복사하게 됨.</code></p>

<h3 id="isknownuniquelyreferenced">isKnownUniquelyReferenced</h3>
<p>CoW의 핵심 메서드.
파라미터로 받는 값이 inout 즉, 레퍼런스로서 해당 레퍼런스에 참조가 1개일 때는 true, 여러 개 일때는 false를 반환.
참고로 다중 스레드에서 동시에 접근하는 객체에 대해 isKnownUniquelyReferenced를 실행하면 true가 나올 수도 있음.
그래서 isKnownUniquelyReferenced를 검사할 때는 항상 동기화 된 스레드 환경에서만 진행해야 함.</p>

<h1 id="reference">Reference</h1>
<ol>
  <li><a href="https://soooprmx.com/archives/6118">soooprmx 숩님 블로그 defer</a><br /></li>
  <li><a href="https://soooprmx.com/archives/7047">soooprmx 숩님 블로그 Sequence Protocol</a><br /></li>
  <li><a href="https://soooprmx.com/archives/7049">soooprmx 숩님 블로그 Collection Protocol</a><br /></li>
  <li><a href="https://oaksong.github.io/2018/01/06/copy-on-write/">OAKSONG님 블로그 CoW</a><br /></li>
  <li><a href="https://developer.apple.com/documentation/swift/2429905-isknownuniquelyreferenced">isKnownUniquelyReferenced 오피셜</a><br /></li>
</ol>
:ET